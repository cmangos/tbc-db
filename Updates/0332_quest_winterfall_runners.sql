-- Quest 'Winterfall Runners'
-- This part always happens
DELETE FROM `dbscripts_on_quest_end` WHERE id = '5087';
INSERT INTO dbscripts_on_quest_end(id, delay, priority, command, datalong, datalong2, datalong3, buddy_entry, search_radius, data_flags, dataint, dataint2, dataint3, dataint4, datafloat, x, y, z, o, speed, condition_id, comments) VALUES
(5087,0,1,21,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Set Active'),
(5087,0,2,29,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Remove QuestFlags'),
(5087,0,3,20,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Start Waypoints');

UPDATE `quest_template` SET `CompleteScript`='5087' WHERE `entry`='5087';

-- Donova Snowden waypoints
SET @PATH := 9298;
DELETE FROM creature_movement_template WHERE `Entry` = @PATH;
INSERT INTO `creature_movement_template` (`Entry`, `PathId`, `Point`, `PositionX`, `PositionY`, `PositionZ`, `Orientation`, `WaitTime`, `ScriptId`) VALUES 
(@PATH,0,1,6393.311,-2531.2017,541.43024,100,0,0),
(@PATH,0,2,6390.147,-2529.2485,540.6507,100,1000,929800),
(@PATH,0,3,6395.5728,-2536.7476,541.6417,100,0,0),
(@PATH,0,4,6395.5728,-2536.7476,541.6417,2.426007747650146484,1000,929801);

DELETE FROM `dbscripts_on_creature_movement` WHERE id IN (929800, 929801, 1437200, 1091600);
INSERT INTO dbscripts_on_creature_movement(id, delay, priority, command, datalong, datalong2, datalong3, buddy_entry, search_radius, data_flags, dataint, dataint2, dataint3, dataint4, datafloat, x, y, z, o, speed, condition_id, comments) VALUES
(929800,0,0,32,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Pause Waypoints'),
(929800,0,1,0,0,0,0,0,0,0,6231,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Say EmoteText'),
(929800,3000,0,0,0,0,0,0,0,0,6232,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Say Text'),
(929800,3000,1,10,14372,180000,1,0,0,8,1,0,0,0,0,6389.5317,-2501.9636,541.0671, 1.6231,0,4000,'Donova Snowden - Spawn Winterfall Ambusher'),
(929800,3000,2,10,14372,180000,1,0,0,8,1,0,0,0,0,6386.3447,-2501.3552,540.42206,3.52556,0,4000,'Donova Snowden - Spawn Winterfall Ambusher'),
(929800,3000,3,10,14372,180000,1,0,0,8,1,0,0,0,0,6389.5327,-2498.4856,540.7365,5.2010,0,4000,'Donova Snowden - Spawn Winterfall Ambusher'),
(929800,6000,0,0,0,0,0,0,0,0,6233,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Say Text'),
(929800,11000,0,25,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Set Run'),
(929800,12000,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Unpause Waypoints'),
(929801,0,0,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Remove Waypoint Movement'),
(929800,0,1,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Remove Run'),
(929801,2000,1,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Remove Active'),
(929801,2000,2,29,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Donova Snowden - Add QuestFlags'),
(1437200,2000,0,20,1,10,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,'Winterfall Ambusher - Start RandomMovement'),
(1091600,1000,0,18,0,0,0,10916,20,1,0,0,0,0,0,0,0,0,0,0,0,'Winterfall runner - Despawn friend'),
(1091600,1000,1,18,0,0,0,10916,20,1,0,0,0,0,0,0,0,0,0,0,0,'Winterfall runner - Despawn friend'),
(1091600,1000,2,18,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,'Winterfall runner - Despawn self');

UPDATE `creature_template` SET `MovementType`='2' WHERE (`Entry`='14372');

SET @PATH := 14372;
DELETE FROM creature_movement_template WHERE `Entry` = @PATH;
INSERT INTO `creature_movement_template` (`Entry`, `PathId`, `Point`, `PositionX`, `PositionY`, `PositionZ`, `Orientation`, `WaitTime`, `ScriptId`, `Comment`) VALUES 
(@PATH,1,1,6380.987,-2520.9492,538.0356,100,5000,1437200, '');

-- Text emote
UPDATE `broadcast_text` SET `ChatTypeID`='2' WHERE (`Id`='6231');

DELETE FROM conditions WHERE condition_entry = '4000';
INSERT INTO `conditions` (`condition_entry`, `type`, `value1`, `value2`, `flags`, `comments`) VALUES 
('4000', '37', '14372', '20', '1', 'Winterfall Ambusher in Range');

-- Update spawn Positions from Winterfall Runners
-- 0x204CB000200AA900000064000039F0B5 Mover
UPDATE `creature` SET `position_x`='6904.6416', `position_y`='-2296.5254', `position_z`='589.17346', `orientation`='4.118977' WHERE (`guid`='42250'); 
UPDATE `creature` SET `position_x`='6908.5347', `position_y`='-2298.954', `position_z`='588.86053', `orientation`='3.54129' WHERE (`guid`='42251');
UPDATE `creature` SET `position_x`='6898.7153', `position_y`='-2293.98', `position_z`='587.87805', `orientation`='5.51886' WHERE (`guid`='42252'); 

-- Delete old Waypoints
DELETE FROM creature_movement WHERE Id = '42250';

-- delete old linking
DELETE FROM creature_linking WHERE master_guid = 42250;

-- Set creatures active all the time, to make sure their waypoints will always go threw
UPDATE creature_template SET ExtraFlags = ExtraFlags + 4096 WHERE entry = 10916;

-- Add them into spawn_group
DELETE FROM `spawn_group` WHERE `Id` = '19004';
INSERT INTO `spawn_group` (`Id`, `Name`, `Type`, `MaxCount`, `WorldState`, `Flags`) VALUES 
('19004', 'Winterspring - Winterfall Runner', '0', '3', '0', '3');

DELETE FROM `spawn_group_formation` WHERE `Id` = '19004';
INSERT INTO `spawn_group_formation` (`Id`, `FormationType`, `FormationSpread`, `FormationOptions`, `PathId`, `MovementType`, `Comment`) VALUES 
('19004', '4', '5', '0', '19004', '2', 'Winterspring - Winterfall Runner');

DELETE FROM `spawn_group_spawn` WHERE `Id` = '19004';
INSERT INTO `spawn_group_spawn` (`Id`, `Guid`, `SlotId`) VALUES 
('19004', '42250', '0'),
('19004', '42251', '1'),
('19004', '42252', '2');

DELETE FROM waypoint_path_name WHERE PathId = '19004';
INSERT INTO `waypoint_path_name` (`PathId`, `Name`) VALUES 
('19004', 'Kalimdor - Winterspring - Winterfall Runners');

-- Winterfell Runners waypoints - sniffed from tbc ptr
SET @PATH := 19004; -- spawn_group due to formation pathing
DELETE FROM waypoint_path WHERE `PathId` = @PATH;
INSERT INTO `waypoint_path` (`PathId`, `Point`, `PositionX`, `PositionY`, `PositionZ`, `Orientation`, `WaitTime`, `ScriptId`) VALUES 
(@PATH,1,6883.397,-2307.2742,582.3803,100,0,0),
(@PATH,2,6860.4766,-2308.3794,579.95636,100,0,0),
(@PATH,3,6840.4126,-2307.9648,580.43805,100,0,0),
(@PATH,4,6818.5215,-2307.6135,580.9789,100,0,0),
(@PATH,5,6804.612,-2309.247,580.0708,100,0,0),
(@PATH,6,6784.8354,-2323.5396,576.488,100,0,0),
(@PATH,7,6754.5654,-2334.0676,572.16656,100,0,0),
(@PATH,8,6725.491,-2338.0579,570.0515,100,0,0),
(@PATH,9,6687.617,-2338.2476,570.35675,100,0,0),
(@PATH,10,6666.604,-2343.5479,570.6366,100,0,0),
(@PATH,11,6656.4536,-2360.2861,569.29114,100,0,0),
(@PATH,12,6625.617,-2374.327,572.4637,100,0,0),
(@PATH,13,6606.411,-2393.626,572.24335,100,0,0),
(@PATH,14,6589.174,-2401.6055,573.74,100,0,0),
(@PATH,15,6564.564,-2419.217,575.0133,100,0,0),
(@PATH,16,6538.905,-2436.4724,575.5397,100,0,0),
(@PATH,17,6517.192,-2450.7263,572.9729,100,0,0),
(@PATH,18,6516.865,-2476.7385,568.825,100,0,0),
(@PATH,19,6519.787,-2506.7476,568.15985,100,0,0),
(@PATH,20,6523.7876,-2538.1907,568.15625,100,0,0),
(@PATH,21,6525.3164,-2571.3042,567.9315,100,0,0),
(@PATH,22,6532.3286,-2609.9778,564.35657,100,0,0),
(@PATH,23,6536.6816,-2647.0208,564.99615,100,0,0),
(@PATH,24,6542.336,-2683.8499,567.55774,100,0,0),
(@PATH,25,6548.317,-2722.467,570.3727,100,0,0),
(@PATH,26,6550.4497,-2763.961,569.3126,100,0,0),
(@PATH,27,6547.611,-2788.2397,572.2039,100,0,0),
(@PATH,28,6544.617,-2815.301,578.1884,100,0,0),
(@PATH,29,6541.099,-2847.6921,585.2842,100,0,0),
(@PATH,30,6537.7686,-2888.2166,588.3924,100,0,0),
(@PATH,31,6537.942,-2926.906,589.85614,100,0,0),
(@PATH,32,6539.8555,-2964.0608,591.88007,100,0,0),
(@PATH,33,6545.69,-3002.5942,594.2931,100,0,0),
(@PATH,34,6547.881,-3035.5293,596.47046,100,0,0),
(@PATH,35,6562.4185,-3070.22,598.8057,100,0,0),
(@PATH,36,6575.7964,-3105.8694,600.9687,100,0,0),
(@PATH,37,6593.9087,-3146.255,602.7558,100,0,0),
(@PATH,38,6606.138,-3187.1528,606.1534,100,0,0),
(@PATH,39,6617.757,-3231.0496,613.23065,100,0,0),
(@PATH,40,6628.3384,-3271.527,620.97656,100,0,0),
(@PATH,41,6637.586,-3311.9265,628.39996,100,0,0),
(@PATH,42,6642.4497,-3359.452,637.30615,100,0,0),
(@PATH,43,6645.7773,-3407.3574,650.5073,100,0,0),
(@PATH,44,6644.328,-3450.009,662.3237,100,0,0),
(@PATH,45,6644.9873,-3495.0098,671.6823,100,0,0),
(@PATH,46,6646.2983,-3538.2297,678.72394,100,0,0),
(@PATH,47,6652.639,-3586.178,688.10547,100,0,0),
(@PATH,48,6656.6426,-3627.0176,694.33386,100,0,0),
(@PATH,49,6661.2827,-3652.7236,696.0284,100,0,0),
(@PATH,50,6670.4595,-3677.5547,695.3266,100,0,0),
(@PATH,51,6684.9014,-3720.9067,692.3158,100,0,0),
(@PATH,52,6697.434,-3761.659,688.47046,100,0,0),
(@PATH,53,6714.619,-3803.5798,685.5921,100,0,0),
(@PATH,54,6731.653,-3812.7708,685.0921,100,0,0),
(@PATH,55,6754.172,-3845.9563,682.05383,100,0,0),
(@PATH,56,6778.5703,-3877.2495,681.60626,100,0,0),
(@PATH,57,6797.733,-3913.7466,682.04645,100,0,0),
(@PATH,58,6809.807,-3958.8918,684.6458,100,0,0),
(@PATH,59,6821.4805,-3988.9385,687.7111,100,0,0),
(@PATH,60,6837.932,-4017.0369,688.53424,100,0,0),
(@PATH,61,6854.178,-4058.2942,689.03125,100,0,0),
(@PATH,62,6889.2524,-4093.0474,691.1778,100,0,0),
(@PATH,63,6928.76,-4123.306,692.4278,100,0,0),
(@PATH,64,6964.7744,-4138.483,695.62726,100,0,0),
(@PATH,65,7011.4004,-4147.316,697.60925,100,0,0),
(@PATH,66,7047.417,-4149.6777,700.52515,100,0,0),
(@PATH,67,7064.6587,-4188.405,703.2609,100,0,0),
(@PATH,68,7087.34,-4223.3657,695.23785,100,0,0),
(@PATH,69,7109.225,-4258.7993,680.7249,100,0,0),
(@PATH,70,7114.1626,-4297.3438,672.27106,100,0,0),
(@PATH,71,7114.651,-4334.7554,661.4651,100,0,0),
(@PATH,72,7122.7134,-4371.7075,651.27686,100,0,0),
(@PATH,73,7138.5938,-4402.044,643.7828,100,0,0),
(@PATH,74,7155.247,-4433.6426,635.5412,100,0,0),
(@PATH,75,7176.8623,-4459.873,626.74255,100,0,0),
(@PATH,76,7207.6646,-4488.7437,616.0163,100,0,0),
(@PATH,77,7247.3345,-4505.738,604.5187,100,0,0),
(@PATH,78,7278.143,-4525.275,590.0195,100,0,0),
(@PATH,79,7308.1226,-4559.305,589.8831,100,0,0),
(@PATH,80,7338.3115,-4594.8496,592.388,100,0,0),
(@PATH,81,7353.3335,-4610.618,600.96533,100,0,0),
(@PATH,82,7369.155,-4639.6587,608.93616,100,0,0),
(@PATH,83,7375.5835,-4663.561,620.7311,100,0,0),
(@PATH,84,7389.488,-4684.435,630.76666,100,0,0),
(@PATH,85,7403.2676,-4715.996,646.9597,100,0,0),
(@PATH,86,7402.701,-4714.664,646.5034,100,0,0),
(@PATH,87,7399.332,-4740.424,655.72534,100,0,0),
(@PATH,88,7353.4565,-4742.8213,661.22375,100,0,0),
(@PATH,89,7335.605,-4731.386,664.62946,100,0,0),
(@PATH,90,7305.079,-4754.4673,673.8997,100,0,0),
(@PATH,91,7284.908,-4782.4272,681.1078,100,0,0),
(@PATH,92,7247.8296,-4807.4844,686.2208,100,0,0),
(@PATH,93,7216.407,-4822.1255,693.4069,100,0,0),
(@PATH,94,7188.5166,-4856.708,698.6139,100,0,0),
(@PATH,95,7163.0396,-4866.733,698.4728,100,0,0),
(@PATH,96,7130.868,-4863.4517,696.75073,100,0,0),
(@PATH,97,7082.917,-4862.369,696.10077,100,0,0),
(@PATH,98,7052.2993,-4870.6294,696.03937,100,0,0),
(@PATH,99,7022.1196,-4886.9287,695.97424,100,0,0),
(@PATH,100,7004.4697,-4899.9243,695.72424,100,0,0),
(@PATH,101,6965.521,-4927.568,692.20795,100,0,0),
(@PATH,102,6945.8076,-4962.3,690.8763,100,0,0),
(@PATH,103,6940.607,-4999.3896,691.8817,100,0,0),
(@PATH,104,6934.691,-5032.5713,692.1778,100,0,0),
(@PATH,105,6926.44,-5044.0244,691.1906,100,0,0),
(@PATH,106,6901.048,-5056.6895,688.9554,100,0,0),
(@PATH,107,6880.2124,-5061.403,688.8325,100,0,0),
(@PATH,108,6857.0454,-5075.4688,689.83417,100,0,0),
(@PATH,109,6813.94,-5095.202,695.06555,100,0,0),
(@PATH,110,6787.3076,-5105.598,703.3073,100,0,0),
(@PATH,111,6777.7065,-5111.5415,710.1192,100,0,0),
(@PATH,112,6772.0186,-5123.901,719.5323,100,0,0),
(@PATH,113,6761.592,-5137.4907,725.945,100,0,0),
(@PATH,114,6740.9775,-5155.317,733.0837,100,0,0),
(@PATH,115,6728.4688,-5177.6196,744.28705,100,0,0),
(@PATH,116,6721.9565,-5189.743,752.1503,100,0,0),
(@PATH,117,6725.942,-5199.338,756.4035,100,0,0),
(@PATH,118,6739.176,-5203.9043,760.8345,100,0,0),
(@PATH,119,6737.143,-5214.222,764.9502,100,0,0),
(@PATH,120,6727.2466,-5223.838,772.4213,100,0,0),
(@PATH,121,6715.482,-5239.652,779.11346,100,0,0),
(@PATH,122,6720.427,-5261.178,778.58417,100,2000,1091600);